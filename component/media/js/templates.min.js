/**
 * @package   socialmagick
 * @copyright Copyright (c)2025 Nicholas K. Dionysopoulos / Akeeba Ltd
 * @license   GNU General Public License version 3, or later
 */

((window, document) => {
  const UNITS = ["B", "KiB", "MiB", "GiB", "TiB", "PiB", "EiB", "ZiB", "YiB"];
  const UNIT_SIZE = 1024;
  const formatDecimals = (num, decimals = 2) => {
    return Number(Math.round(num + "e" + decimals) + "e-" + decimals);
  };
  const bytesToString = bytes => {
    if (bytes === 0) {
      return "0 B";
    }
    const exp = Math.min(Math.floor(Math.log(bytes) / Math.log(UNIT_SIZE)), UNITS.length - 1);
    const size = bytes / Math.pow(UNIT_SIZE, exp);
    const unit = UNITS[exp];
    return `${formatDecimals(size)} ${unit}`;
  };
  document.addEventListener("DOMContentLoaded", async () => {
    const elContainer = document.getElementById("socialMagickTotalImageSizeNotice");
    const elSize = document.getElementById("socialMagickTotalImageSize");
    elContainer?.classList?.add("d-none");
    const token = Joomla.getOptions("csrf.token", "");
    const formData = new FormData();
    if (token) {
      formData.set(token, 1);
    }
    const response = await fetch("index.php?option=com_socialmagick&view=templates&task=imagestotalsize&format=json", {
      method: "POST",
      body: formData
    });
    if (!response.ok) {
      Joomla.renderMessages({
        error: [Joomla.Text._("COM_SOCIALMAGICK_TEMPLATE_ERR_IMAGESIZE_NETWORK") + response.statusText]
      });
    }
    var data = {};
    try {
      data = await response.json();
    } catch (err) {
      data = {};
      Joomla.renderMessages({
        error: [Joomla.Text._("COM_SOCIALMAGICK_TEMPLATE_ERR_IMAGESIZE_JSON") + response.statusText]
      });
    }

    // TODO data.total
    elContainer?.classList?.remove("d-none");
    if (elSize) {
      elSize.innerText = bytesToString(data?.total ?? 0);
    }
  });
})(window, document);

//# sourceMappingURL=templates.min.js.map